<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Getting Started · Apify SDK v2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Without the right tools, crawling and scraping the web can be a difficult thing. At the very least, you need an HTTP client to make the necessary"/><meta name="docsearch:version" content="1.0.1"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Getting Started · Apify SDK v2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sdk.apify.com/"/><meta property="og:description" content="Without the right tools, crawling and scraping the web can be a difficult thing. At the very least, you need an HTTP client to make the necessary"/><meta property="og:image" content="https://sdk.apify.com/img/apify_og_SDK.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sdk.apify.com/img/apify_og_SDK.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-67003981-4"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-67003981-4');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/apify_logo.svg" alt="Apify SDK v2"/><h2 class="headerTitleWithLogo">Apify SDK v2</h2></a><a href="/versions"><h3>1.0.1</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class="siteNavGroupActive"><a href="/docs/1.0.1/guides/motivation" target="_self">Guide</a></li><li class="siteNavGroupActive"><a href="/docs/1.0.1/examples/crawl-multiple-urls" target="_self">Examples</a></li><li class="siteNavGroupActive"><a href="/docs/1.0.1/api/apify" target="_self">API Reference</a></li><li class=""><a href="https://github.com/apify/apify-sdk-v2" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guide</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/motivation">Motivation</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/quick-start">Quick Start</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/apify-platform">Apify Platform</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/1.0.1/guides/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/request-storage">Request Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/result-storage">Result Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/environment-variables">Environment Variables</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/proxy-management">Proxy Management</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/session-management">Session Management</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/type-script-actor">TypeScript Actors</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/docker-images">Running in Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/guides/migration-to-v1">Migration to version 1</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Examples<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/accept-user-input">Accept user input</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/add-data-to-dataset">Add data to dataset</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/basic-crawler">Basic crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/call-actor">Call actor</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/capture-screenshot">Capture a screenshot</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/cheerio-crawler">Cheerio crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-all-links">Crawl all links on a website</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-multiple-urls">Crawl multiple URLs</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-relative-links">Crawl a website with relative links</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-single-url">Crawl a single URL</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-sitemap">Crawl a sitemap</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/crawl-some-links">Crawl some links on a website</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/forms">Forms</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/map-and-reduce">Dataset Map and Reduce methods</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/playwright-crawler">Playwright crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/puppeteer-crawler">Puppeteer crawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/puppeteer-recursive-crawl">Puppeteer recursive crawl</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/puppeteer-with-proxy">Puppeteer with proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/synchronous-run">Synchronous run</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/examples/use-stealth-mode">Use stealth mode</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/apify">Apify</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Crawlers</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/basic-crawler">BasicCrawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/cheerio-crawler">CheerioCrawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/playwright-crawler">PlaywrightCrawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/puppeteer-crawler">PuppeteerCrawler</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/statistics">Statistics</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Result Stores</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/dataset">Dataset</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/key-value-store">KeyValueStore</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Scaling</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/autoscaled-pool">AutoscaledPool</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/session">Session</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/session-pool">SessionPool</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/proxy-configuration">ProxyConfiguration</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/snapshotter">Snapshotter</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/system-status">SystemStatus</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Sources</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/request">Request</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/request-list">RequestList</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/request-queue">RequestQueue</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/pseudo-url">PseudoUrl</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Utilities</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/utils">utils</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/log">utils.log</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/playwright">utils.playwright</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/puppeteer">utils.puppeteer</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/social">utils.social</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Type Definitions<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Constructor Options</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/autoscaled-pool-options">AutoscaledPoolOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/basic-crawler-options">BasicCrawlerOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/cheerio-crawler-options">CheerioCrawlerOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/playwright-crawler-options">PlaywrightCrawlerOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/playwright-launch-context">PlaywrightLaunchContext</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/puppeteer-crawler-options">PuppeteerCrawlerOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/puppeteer-launch-context">PuppeteerLaunchContext</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/proxy-configuration-options">ProxyConfigurationOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/proxy-info">ProxyInfo</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/logger-options">LoggerOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/request-options">RequestOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/request-list-options">RequestListOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/request-as-browser-options">RequestAsBrowserOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/session-options">SessionOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/session-pool-options">SessionPoolOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/snapshotter-options">SnapshotterOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/stealth-options">StealthOptions</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/system-status-options">SystemStatusOptions</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions - Crawlers</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/cheerio-handle-page">CheerioHandlePage</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/cheerio-handle-page-inputs">CheerioHandlePageInputs</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/handle-failed-request">HandleFailedRequest</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/handle-failed-request-input">HandleFailedRequestInput</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/handle-request">HandleRequest</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/handle-request-inputs">HandleRequestInputs</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/prepare-request">PrepareRequest</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/prepare-request-inputs">PrepareRequestInputs</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/puppeteer-handle-page">PuppeteerHandlePage</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/puppeteer-handle-page-inputs">PuppeteerHandlePageInputs</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions - Dataset</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/dataset-consumer">DatasetConsumer</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/dataset-mapper">DatasetMapper</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/dataset-reducer">DatasetReducer</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions - KeyValueStore</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/key-consumer">KeyConsumer</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions - Sessions</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/create-session">CreateSession</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Functions - Utilities</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/request-transform">RequestTransform</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Return Types</h4><ul><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/actor-run">ActorRun</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/api/apify-call-error">ApifyCallError</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/apify-env">ApifyEnv</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/dataset-content">DatasetContent</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/memory-info">MemoryInfo</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/queue-operation-info">QueueOperationInfo</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/request-list-state">RequestListState</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/session-state">SessionState</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/social-handles">SocialHandles</a></li><li class="navListItem"><a class="navItem" href="/docs/1.0.1/typedefs/system-info">SystemInfo</a></li></ul></div></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Getting Started</h1></header><article><div><span><p>Without the right tools, crawling and scraping the web can be a difficult thing. At the very least, you need an HTTP client to make the necessary
requests, but that only gets you raw HTML and sometimes not even that. Then you have to read this HTML and extract the data you're interested in. Once
extracted, it must be stored in a machine-readable format and easily accessible for further processing, because it is the processed data that hold
value.</p>
<p>Apify SDK covers the process end-to-end. From crawling the web for links and scraping the raw data to storing it in various machine readable formats,
ready for processing. With this guide in hand, you should have your own data extraction solutions up and running in a few hours.</p>
<h2><a class="anchor" aria-hidden="true" id="intro"></a><a href="#intro" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Intro</h2>
<p>The goal of this getting started guide is to provide a step-by-step introduction to all the features of the Apify SDK. It will walk you through
creating the simplest of crawlers that only print text to console, all the way up to complex systems that crawl pages, interact with them as if a real
user were sitting in front of a real browser and output structured data.</p>
<p>Since Apify SDK is usable both locally on any computer and on the <a href="../guides/apify-platform">Apify Platform</a>, you will be able
to use the source code in both environments interchangeably. Nevertheless, some initial setup is still required, so choose your preferred starting
environment and let's get into it.</p>
<h2><a class="anchor" aria-hidden="true" id="setting-up-locally"></a><a href="#setting-up-locally" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up locally</h2>
<p>To run Apify SDK on your own computer, you need to meet the following pre-requisites first:</p>
<ol>
<li>Have Node.js version 10.17 or higher, with the exception of Node.js 11, installed.
<ul>
<li>Visit <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node.js website</a> to download or use
<a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a></li>
</ul></li>
<li>Have NPM installed.
<ul>
<li>NPM comes bundled with Node.js so you should already have it. If not, reinstall Node.js.</li>
</ul></li>
</ol>
<p>If you're not certain, confirm the pre-requisites by running:</p>
<pre><code class="hljs css language-bash">node -v
</code></pre>
<pre><code class="hljs css language-bash"><span class="token function">npm</span> -v
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="creating-a-new-project"></a><a href="#creating-a-new-project" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a new project</h3>
<p>The fastest and best way to create new projects with the Apify SDK is to use our own
<a href="https://www.npmjs.com/package/apify-cli" target="_blank" rel="noopener">Apify CLI</a>. This command line tool allows you to create, run and manage Apify
projects with ease, including their deployment to the <a href="../guides/apify-platform">Apify platform</a> if you wish to run them in the
cloud after developing them locally.</p>
<p>Let's install the Apify CLI with the following command:</p>
<pre><code class="hljs css language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g apify-cli
</code></pre>
<p>Once the installation finishes, all you need to do to set up an Apify SDK project is to run:</p>
<pre><code class="hljs css language-bash">apify create my-new-project
</code></pre>
<p>A prompt will be shown, asking to choose a template. Disregard the different options for now and choose the template labeled <code>Hello world</code>. The
command will now create a new directory in your current working directory, called <code>my-new-project</code>, create a <code>package.json</code> in this folder and install
all the necessary dependencies. It will also add example source code that you can immediately run.</p>
<p>Let's try that!</p>
<pre><code class="hljs css language-bash"><span class="token builtin class-name">cd</span> my-new-project
</code></pre>
<pre><code class="hljs css language-bash">apify run -p
</code></pre>
<blockquote>
<p>The <code>-p</code> flag is great to remember, because it stands for <code>--purge</code> and it clears out your persistent storages before starting the actor.
<code>INPUT.json</code> and named storages are kept. Whenever you're just restarting your actor and you're not interested in the data of the previous run, you
should use <code>apify run -p</code> to prevent the old state from messing with your current run. If this is confusing, don't worry. You'll learn about
storages and <code>INPUT.json</code> soon.</p>
</blockquote>
<p>You should start seeing log messages in the terminal as the system boots up and after a second, a Chromium browser window should pop up. In the
window, you'll see quickly changing pages and back in the terminal, you should see the titles (contents of the <code>&lt;title&gt;</code> HTML tags) of the pages
printed.</p>
<p>You can always terminate the crawl with a keypress in the terminal:</p>
<pre><code class="hljs css language-bash">CTRL+C
</code></pre>
<p>Did you see all that? If you did, congratulations! You're ready to go!</p>
<h2><a class="anchor" aria-hidden="true" id="setting-up-on-the-apify-platform"></a><a href="#setting-up-on-the-apify-platform" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up on the Apify Platform</h2>
<p>Maybe you don't have Node.js installed and don't want the hassle. Or you can't install anything on your computer because you're using a company
provided one. Or perhaps you'd just prefer to start working in the cloud right away. Well, no worries, we've got you covered.</p>
<p>The <a href="../guides/apify-platform">Apify platform</a> is the foundational product of
<a href="https://apify.com" target="_blank" rel="noopener">Apify</a>. It's a serverless cloud computing platform, specifically designed for any web automation jobs,
that may include crawling and scraping, but really works amazing for any batch jobs and long running tasks.</p>
<p>It comes with a free account, so let's go to our <a href="https://my.apify.com/sign-up" target="_blank" rel="noopener">sign-up page</a> and create one, if you
haven't already. Don't forget to verify your email. Without it, you won't be able to run any projects.</p>
<p>Once you're in, you might be prompted by our in-app help to walk through a step-by-step guide into some of our new features. Feel free to finish that,
if you'd like, but once you're done, click on the <strong>Actors</strong> tab in the left menu. To read more about <strong>Actors</strong>, see:
<a href="../guides/apify-platform#what-is-an-actor">What is an Actor</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="creating-a-new-project-1"></a><a href="#creating-a-new-project-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a new project</h3>
<p>In the page that shows after clicking on Actors in the left menu, choose <strong>Create new</strong>. Give it a name in the form that opens, let's say,
<code>my-new-actor</code>. Disregard all the available options for now and save your changes.</p>
<p>Now click on the <strong>Sources</strong> tab at the top. Disregard the version and environment variables inputs for now and proceed directly to <strong>Source code</strong>.
This is where you develop the actor, if you choose not to do it locally. Just press <strong>Run</strong> below the <strong>Source code</strong> panel. It will automatically
build and run the example source code. You should start seeing log messages that represent the build and after the build is complete, log messages of
the running actor. Feel free to check out the other <strong>Run</strong> tabs, such as <strong>Info</strong>, where you can find useful information about the run, or
<strong>Key-value-store</strong>, where the actor's <strong>INPUT</strong> and <strong>OUTPUT</strong> are stored.</p>
<p>Good job. You're now ready to run your own source code on the Apify Platform. For more information visit the
<a href="https://docs.apify.com/actor" target="_blank" rel="noopener">Actor documentation page</a>, where you'll find everything about the platform's various
options.</p>
<h2><a class="anchor" aria-hidden="true" id="first-crawler"></a><a href="#first-crawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First crawler</h2>
<p>Whether you've chosen to develop locally or in the cloud, it's time to start writing some actual source code. But before we do, let me just briefly
introduce all the Apify SDK classes necessary to make it happen.</p>
<h3><a class="anchor" aria-hidden="true" id="the-general-idea"></a><a href="#the-general-idea" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The general idea</h3>
<p>There are 3 crawler classes available for use in the Apify SDK. <a href="../api/basic-crawler"><code>BasicCrawler</code></a>, <a href="../api/cheerio-crawler"><code>CheerioCrawler</code></a>
and <a href="../api/puppeteer-crawler"><code>PuppeteerCrawler</code></a>. We'll talk about their differences later. Now, let's talk about what they have in common.</p>
<p>All the crawlers' general idea is to go to a web page, open it, do some stuff there, save some results and continue to the next page, until it's done
its job. So each time the crawler needs to find answers to two questions: <strong>Where should I go?</strong> and <strong>What should I do there?</strong>. Answering those two
questions is the only setup mandatory to run the crawlers.</p>
<h3><a class="anchor" aria-hidden="true" id="the-where-request-requestlist-and-requestqueue"></a><a href="#the-where-request-requestlist-and-requestqueue" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Where - <code>Request</code>, <code>RequestList</code> and <code>RequestQueue</code></h3>
<p>All crawlers use instances of the <a href="../api/request"><code>Request</code></a> class to determine where they need to go. Each request may hold a lot of information,
but at the very least, it must hold a URL - a web page to open. But having only one URL would not make sense for crawling. We need to either have a
pre-existing list of our own URLs that we wish to visit, perhaps a thousand, or a million, or we need to build this list dynamically as we crawl,
adding more and more URLs to the list as we progress.</p>
<p>A representation of the pre-existing list is an instance of the <a href="../api/request-list"><code>RequestList</code></a> class. It is a static, immutable list of URLs and
other metadata (see the <a href="../api/request"><code>Request</code></a> object) that the crawler will visit, one by one, retrying whenever an error occurs, until there
are no more <code>Requests</code> to process.</p>
<p><a href="../api/request-queue"><code>RequestQueue</code></a> on the other hand, represents a dynamic queue of <code>Requests</code>. One that can be updated at runtime by adding more
pages - <code>Requests</code> to process. This allows the crawler to open one page, extract interesting URLs, such as links to other pages on the same domain,
add them to the queue (called <em>enqueuing</em>) and repeat this process to build a queue of tens of thousands or more URLs while knowing only a single one
at the beginning.</p>
<p><code>RequestList</code> and <code>RequestQueue</code> are essential for the crawler's operation. There is no other way to supply <code>Requests</code> = &quot;pages to crawl&quot; to the
crawlers. At least one of them always needs to be provided while setting up. You can also use both at the same time, if you wish.</p>
<h3><a class="anchor" aria-hidden="true" id="the-what-handlepagefunction"></a><a href="#the-what-handlepagefunction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The What - <code>handlePageFunction</code></h3>
<p>The <code>handlePageFunction</code> is the brain of the crawler. It tells it what to do at each and every page it visits. Generally it handles extraction of data
from the page, processing the data, saving it, calling APIs, doing calculations and whatever else you need it to do, really.</p>
<p>The <code>handlePageFunction</code> is provided by you, the user, and invoked automatically by the crawler for each <code>Request</code> from either the <code>RequestList</code> or
<code>RequestQueue</code>. It always receives a single argument and that is a plain <code>Object</code>. Its properties change depending on the used crawler class, but it
always includes at least the <code>request</code> property, which represents the currently crawled <code>Request</code> instance (i.e. the URL the crawler is visiting and
related metadata) and the <code>autoscaledPool</code> property, which is an instance of the <a href="../api/autoscaled-pool"><code>AutoscaledPool</code></a> class and we'll talk about
it in detail later.</p>
<pre><code class="hljs css language-js"><span class="token comment">// The object received as a single argument by the handlePageFunction</span>
<span class="token punctuation">{</span>
    request<span class="token operator">:</span> Request<span class="token punctuation">,</span>
    autoscaledPool<span class="token operator">:</span> AutoscaledPool
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="putting-it-all-together"></a><a href="#putting-it-all-together" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Putting it all together</h3>
<p>Enough theory! Let's put some of those hard learned facts into practice. We learned above that we need <code>Requests</code> and a <code>handlePageFunction</code> to setup
a crawler. We will also use the <a href="../api/apify#main"><code>Apify.main()</code></a> function. It's not mandatory, but it makes our life easier. We'll
learn about it in detail later on.</p>
<p>Let's start super easy. Visit one page, get its title and close. First of all we need to require Apify, to make all of its features available to us:</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Easy right? It doesn't get much more difficult, trust me. For the purposes of this tutorial, we'll be scraping our own webpage
<a href="https://apify.com" target="_blank" rel="noopener">https://apify.com</a>. Now, to get there, we need a <code>Request</code> with the page's URL in one of our sources,
<code>RequestList</code> or <code>RequestQueue</code>. Let's go with <code>RequestQueue</code> for now.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// This is how you use the Apify.main() function.</span>
Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// First we create the request queue instance.</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// And then we add a request to it.</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>If you're not familiar with the <code>async</code> and <code>await</code> keywords used in the example, trust that it is a native syntax in modern JavaScript and you can
<a href="https://nikgrozev.com/2017/10/01/async-await/" target="_blank" rel="noopener">learn more about it here</a>.</p>
</blockquote>
<p>The <a href="../api/request-queue#addrequest"><code>requestQueue.addRequest()</code></a> function automatically converts the plain object we passed to it to a
<code>Request</code> instance, so now we have a <code>requestQueue</code> that holds one <code>request</code> which points to <code>https://apify.com</code>. Now we need the
<code>handlePageFunction</code>.</p>
<pre><code class="hljs css language-js"><span class="token comment">// We'll define the function separately so it's more obvious.</span>
<span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// This should look familiar if you ever worked with jQuery.</span>
    <span class="token comment">// We're just getting the text content of the &lt;title> HTML element.</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Wait, where did the <code>$</code> come from? Remember what we learned about the <code>handlePageFunction</code> earlier. It expects a plain <code>Object</code> as an argument that
will always have a <code>request</code> property, but it will also have other properties, depending on the chosen crawler class. Well, <code>$</code> is a property provided
by the <code>CheerioCrawler</code> class which we'll set up right now.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Set up the crawler, passing a single options object as an argument.</span>
    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        requestQueue<span class="token punctuation">,</span>
        handlePageFunction<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>And we're done! You just created your first crawler from scratch. It will download the HTML of <code>https://apify.com</code>, find the <code>&lt;title&gt;</code> element, get
its text content and print it to console. Good job!</p>
<p>To run the code locally, copy and paste the code, if you haven't already typed it in yourself, to the <code>main.js</code> file in the <code>my-new-project</code> we
created earlier and run <code>apify run</code> from that project's directory.</p>
<p>To run the code on Apify Platform, just replace the original example with your new code and hit Run.</p>
<p>Whichever environment you choose, you should see the message
<code>The title of &quot;https://apify.com&quot; is: Web Scraping, Data Extraction and Automation - Apify.</code> printed to the screen. If you do, congratulations and
let's move onto some bigger challenges! And if you feel like you don't really know what just happened there, no worries, it will all become clear when
you learn more about the <code>CheerioCrawler</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="cheeriocrawler-aka-jquery-crawler"></a><a href="#cheeriocrawler-aka-jquery-crawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CheerioCrawler aka jQuery crawler</h2>
<p>This is the crawler that we used in our earlier example. Our simplest and also the fastest crawling solution. If you're familiar with <code>jQuery</code>, you'll
understand <a href="../api/cheerio-crawler"><code>CheerioCrawler</code></a> in minutes. <a href="https://www.npmjs.com/package/cheerio" target="_blank" rel="noopener">Cheerio</a> is
essentially <code>jQuery</code> for Node.js. It offers the same API, including the familiar <code>$</code> object. You can use it, as you would <code>jQuery</code>, for manipulating
the DOM of a HTML page. In crawling, you'll mostly use it to select the right elements and extract their text values - the data you're interested in.
But <code>jQuery</code> runs in a browser and attaches directly to the browser's DOM. Where does <code>cheerio</code> get its HTML? This is where the <code>Crawler</code> part of
<a href="../api/cheerio-crawler"><code>CheerioCrawler</code></a> comes in.</p>
<h3><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h3>
<p><a href="../api/cheerio-crawler"><code>CheerioCrawler</code></a> crawls by making plain HTTP requests to the provided URLs. As you remember from the previous section, the
URLs are fed to the crawler using either the <a href="../api/cheerio-crawler"><code>RequestList</code></a> or the <a href="../api/cheerio-crawler"><code>RequestQueue</code></a>. The HTTP responses
it gets back are HTML pages, the same pages you would get in your browser when you first load a URL.</p>
<blockquote>
<p>Note, however, that modern web pages often do not serve all of their content in the first HTML response, but rather the first HTML contains links to
other resources such as CSS and JavaScript that get downloaded afterwards and together they create the final page. See our
<a href="../api/puppeteer-crawler"><code>PuppeteerCrawler</code></a> to crawl those.</p>
</blockquote>
<p>Once the page's HTML is retrieved, the crawler will pass it to <a href="https://www.npmjs.com/package/cheerio" target="_blank" rel="noopener">Cheerio</a> for
parsing. The result is the typical <code>$</code> function, which should be familiar to <code>jQuery</code> users. You can use this <code>$</code> to do all sorts of lookups and
manipulations over the page's HTML, but in scraping, we will mostly use it to find specific HTML elements and extract their data.</p>
<p>Example use of Cheerio and its <code>$</code> function in comparison to browser JavaScript:</p>
<pre><code class="hljs css language-js"><span class="token comment">// Return the text content of the &lt;title> element.</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span> <span class="token comment">// plain JS</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cheerio</span>

<span class="token comment">// Return an array of all 'href' links on the page.</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'[href]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// plain JS</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'[href]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cheerio</span>
</code></pre>
<blockquote>
<p>This is not to show that Cheerio is better than plain browser JavaScript. Some might actually prefer the more expressive way plain JS provides.
Unfortunately, the browser JavaScript methods are not available in Node.js, so Cheerio is our best bet to do the parsing.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="when-to-use-cheeriocrawler"></a><a href="#when-to-use-cheeriocrawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>When to use <code>CheerioCrawler</code></h3>
<p>Even though using <code>CheerioCrawler</code> is extremely easy, it probably will not be your first choice for most kinds of crawling or scraping in production
environments. Since most websites nowadays use modern JavaScript to create rich, responsive and data driven user experiences, the plain HTTP requests
the crawler uses may just fall short of your needs.</p>
<p>But <a href="../api/cheerio-crawler"><code>CheerioCrawler</code></a> is far from useless! It really shines when you need to do extremely high workloads. With just 4 GBs of memory and a single CPU
core, you can scrape 500 or more pages a minute! <em>(assuming each page contains approximately 400KB of HTML)</em> To get this high with a full browser
scraper, such as the <a href="../api/puppeteer-crawler"><code>PuppeteerCrawler</code></a>, you'd need significantly more computing power.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li>Extremely fast</li>
<li>Easy to set up</li>
<li>Familiar for jQuery users</li>
<li>Super cheap to run</li>
<li>Each request can go through a different proxy</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li>Does not work for all websites</li>
<li>May easily overload the target website with requests</li>
<li>Does not enable any manipulation of the website before scraping</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="basic-use-of-cheeriocrawler"></a><a href="#basic-use-of-cheeriocrawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic use of <code>CheerioCrawler</code></h3>
<p>Now that we have an idea of the crawler's inner workings, let's build one. We'll use the example from the previous section and improve on it by
letting it truly crawl the page, finding new links as it goes, enqueuing them into the <code>RequestQueue</code> and then scraping them.</p>
<h4><a class="anchor" aria-hidden="true" id="refresher"></a><a href="#refresher" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refresher</h4>
<p>Just to refresh your memory, in the previous section we built a very simple crawler that downloads HTML of a single page, reads its title and prints
it to the console. This is the original source code:</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Set up the crawler, passing a single options object as an argument.</span>
    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        requestQueue<span class="token punctuation">,</span>
        handlePageFunction<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Earlier we said that we would let the crawler:</p>
<ol>
<li>Find new links on the page</li>
<li>Filter only those pointing to <code>apify.com</code></li>
<li>Enqueue them to the <code>RequestQueue</code></li>
<li>Scrape the newly enqueued links</li>
</ol>
<p>So let's get to it!</p>
<h4><a class="anchor" aria-hidden="true" id="finding-new-links"></a><a href="#finding-new-links" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finding new links</h4>
<p>There are numerous approaches to finding links to follow when crawling the web. For our purposes, we will be looking for <code>&lt;a&gt;</code> elements that contain
the <code>href</code> attribute. For example <code>&lt;a href=&quot;https://apify.com/store&gt;This is a link to Apify Store&lt;/a&gt;</code>. To do this, we need to update our Cheerio
function.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Our new function finds all the <code>&lt;a&gt;</code> elements that contain the <code>href</code> attribute and extracts the attributes into an array of strings. There is a
problem though. There can be relative links in the list and those can't be used on their own. We need to resolve them using our domain as base URL and
we will use one of Node.js' standard libraries to do this.</p>
<pre><code class="hljs css language-js"><span class="token comment">// At the top of the file:</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">const</span> ourDomain <span class="token operator">=</span> <span class="token string">'https://apify.com'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> absoluteUrls <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="filtering-links-to-same-domain"></a><a href="#filtering-links-to-same-domain" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Filtering links to same domain</h4>
<p>Websites typically contain a lot of links that lead away from the original page. This is normal, but when crawling a website, we usually want to crawl
this one site and do not let our crawler wander away to Google, Facebook and Twitter. Therefore, we need to filter out the off-domain links and only
keep the ones that lead to the same domain.</p>
<blockquote>
<p>Don't worry, we'll learn how to do this with a single function call using Apify in a few moments.</p>
</blockquote>
<pre><code class="hljs css language-js"><span class="token comment">// At the top of the file:</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ourDomain <span class="token operator">=</span> <span class="token string">'apify.com'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> absoluteUrls <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sameDomainLinks <span class="token operator">=</span> absoluteUrls<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span> url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="enqueueing-links-to-requestqueue"></a><a href="#enqueueing-links-to-requestqueue" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enqueueing links to <code>RequestQueue</code></h4>
<p>This should be easy, because we already did that <a href="#putting-it-all-together">earlier</a>, remember? Just call <code>requestQueue.addRequest()</code> for all the new
links. This will add them to the end of the queue for processing.</p>
<pre><code class="hljs css language-js"><span class="token comment">// At the top of the file:</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ourDomain <span class="token operator">=</span> <span class="token string">'https://apify.com'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> absoluteUrls <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sameDomainLinks <span class="token operator">=</span> absoluteUrls<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span> url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add the requests in series. There's of course room for speed</span>
<span class="token comment">// improvement by parallelization. Try to implement it, if you wish.</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Enqueueing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sameDomainLinks<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> URLs.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> url <span class="token keyword">of</span> sameDomainLinks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> url<span class="token punctuation">.</span>href <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="scrape-the-newly-enqueued-links"></a><a href="#scrape-the-newly-enqueued-links" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scrape the newly enqueued links</h4>
<p>And we're approching the finishing line. All we need to do now is just integrate the new code into our original crawler. It will be easy, because
almost everything needs to go into the <code>handlePageFunction</code>. But just before we do that, let me introduce the first crawler configuration option, that
is not a <code>handlePageFunction</code> or <code>requestQueue</code>. It's called <code>maxRequestsPerCrawl</code>.</p>
<h5><a class="anchor" aria-hidden="true" id="the-maxrequestspercrawl-limit"></a><a href="#the-maxrequestspercrawl-limit" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The <code>maxRequestsPerCrawl</code> limit</h5>
<p>This configuration option is available in all crawler classes and you can use it to limit the number of <code>Requests</code> the crawler should process. It's
very useful when you're just testing your code or when your crawler could potentially crawl millions of pages and you want to save resources. You can
add it to the crawler options like this:</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    requestQueue<span class="token punctuation">,</span>
    handlePageFunction<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>This limits the number of successfully handled <code>Requests</code> to 20. Bear in mind that the actual number of processed requests might be a little higher
and that's because usually there are multiple <code>Requests</code> processed at the same time and once the 20th <code>Request</code> finishes, the other running <code>Requests</code>
will be allowed to finish too.</p>
<h4><a class="anchor" aria-hidden="true" id="putting-it-all-together-1"></a><a href="#putting-it-all-together-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Putting it all together</h4>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;------ This is new.</span>
<span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Here starts the new part of handlePageFunction.</span>
        <span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> ourDomain <span class="token operator">=</span> <span class="token string">'https://apify.com'</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> absoluteUrls <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> sameDomainLinks <span class="token operator">=</span> absoluteUrls<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span> url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Enqueueing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sameDomainLinks<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> URLs.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> url <span class="token keyword">of</span> sameDomainLinks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> url<span class="token punctuation">.</span>href <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// &lt;------ This is new too.</span>
        requestQueue<span class="token punctuation">,</span>
        handlePageFunction<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>No matter if you followed along with our coding or just copy pasted the resulting source, try running it now, perhaps even in both environments. You
should see the crawler log the <strong>title</strong> of the first page, then the <strong>enqueueing</strong> message showing number of URLs, followed by the <strong>title</strong> of the
first enqueued page and so on and so on.</p>
<blockquote>
<p>If you need help with running the code, refer back to the chapters on environment setup: <a href="#setting-up-locally">Setting up locally</a> and
<a href="#setting-up-on-the-apify-platform">Setting up on the Apify Platform</a>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="using-apify-sdk-to-enqueue-links-like-a-boss"></a><a href="#using-apify-sdk-to-enqueue-links-like-a-boss" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using Apify SDK to enqueue links like a boss</h2>
<p>If you were paying attention carefully in the previous chapter, we said that we would show a way to enqueue new <code>Requests</code> with a single function
call. You might be wondering why we had to go through the whole process of getting the individual links, filtering the same domain ones and then
manually enqueuing them into the <code>RequestQueue</code>, when there is a simpler way.</p>
<p>Well, the obvious reason is practice. This is a tutorial after all. The other reason is to make you think about all the bits and pieces that come
together, so that in the end, a new page, not previously entered in by you, can be scraped. We think that by seeing the bigger picture, you will be
able to get the most out of Apify SDK.</p>
<h3><a class="anchor" aria-hidden="true" id="meet-apifyutils"></a><a href="#meet-apifyutils" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Meet <code>Apify.utils</code></h3>
<p>We will talk at length about them later, but in short, <code>Apify.utils</code> is a namespace where you can find various helpful functions and constants that
make your life easier. One of the available functions is <code>Apify.utils.enqueueLinks()</code> which encapsulates the whole enqueueing process and even adds
some extra functionality.</p>
<h3><a class="anchor" aria-hidden="true" id="introduction-to-apifyutilsenqueuelinks"></a><a href="#introduction-to-apifyutilsenqueuelinks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction to <code>Apify.utils.enqueueLinks()</code></h3>
<p>Since enqueuing new links to crawl is such an integral part of web crawling, we created a function that attempts to simplify this process as much as
possible. With a single function call, it allows you to find all the links on a page that match specified criteria and add them to a <code>RequestQueue</code>.
It also allows you to modify the resulting <code>Requests</code> to match your crawling needs.</p>
<p><code>enqueueLinks</code> is quite a powerful function so, like crawlers, it gets its arguments from an options object. This is useful, because you don't have to
remember their order! But also because we can easily extend its API and add new features. You can
<a href="../api/utils#enqueuelinks">find the full reference here</a>.</p>
<p>We suggest using ES6 destructuring to grab the <code>enqueueLinks()</code> function off of the <code>utils</code> object, so you don't have to type <code>Apify.utils</code> all the
time.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    utils<span class="token operator">:</span> <span class="token punctuation">{</span> enqueueLinks <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> Apify<span class="token punctuation">;</span>

<span class="token comment">// Now you can use enqueueLinks like this:</span>
<span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">/* options */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="basic-use-of-enqueuelinks-with-cheeriocrawler"></a><a href="#basic-use-of-enqueuelinks-with-cheeriocrawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Basic use of <code>enqueueLinks()</code> with <code>CheerioCrawler</code></h3>
<p>We already implemented logic that takes care of enqueueing new links to a <code>RequestQueue</code> in the previous chapter on <code>CheerioCrawler</code>. Let's look at
that logic and implement the same functionality using <code>enqueueLinks()</code>.</p>
<p>We found that the crawler needed to do these 4 things to crawl <code>apify.com</code>:</p>
<ol>
<li>Find new links on the page</li>
<li>Filter only those pointing to <code>apify.com</code></li>
<li>Enqueue them to the <code>RequestQueue</code></li>
<li>Scrape the newly enqueued links</li>
</ol>
<p>Using <code>enqueueLinks()</code> we can squash the first 3 into a single function call, if we set the options correctly. For now, let's just stick to the
basics. At the very least, we need a source where to find the links and the queue to enqueue them to. The <code>$</code> Cheerio object is one of the sources the
function accepts and we already know how to work with it in the <code>handlePageFunction</code>. We also know how to get a <code>requestQueue</code> instance.</p>
<pre><code class="hljs css language-js"><span class="token comment">// Assuming previous existence of the '$' and 'requestQueue' variables.</span>
<span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $<span class="token punctuation">,</span> requestQueue <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>That's all we need to do to enqueue all <code>&lt;a href=&quot;...&quot;&gt;</code> links from the given page to the given queue. Easy, right? Scratch number 1 and 3 off the
list. Only number 2 remains and to tackle this one, we need to talk about yet another new concept, the pseudo-URL.</p>
<h4><a class="anchor" aria-hidden="true" id="introduction-to-pseudo-urls"></a><a href="#introduction-to-pseudo-urls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction to pseudo-URLs</h4>
<p>Pseudo-URLs are represented by our <code>PseudoUrl</code> class and even though the name sounds discouraging, they're a pretty simple concept. They're just URLs
with some parts replaced by wildcards (read <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions">regular
expressions</a>). They are matched against URLs to find specific links, domains, patterns, file extensions and so on.</p>
<p>In scraping, there usually are patterns to be found in the websites' URLs that can be leveraged to scrape only the pages we're interested in. Imagine
a typical online store. It has different categories which list different items The URL for might looks something like this:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories
</code></pre>
<p>A category would then have a different URL:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories<span class="token operator">/</span>computers
</code></pre>
<p>Going to this page would produce a list of offered computers. Then, clicking on one of the computers might take us to a detail URL:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">613804</span>
</code></pre>
<p>As you can see, there's a structure to the links. In the real world, the structure might not always be perfectly obvious, but it's very often there.
Pseudo-URLs help to use this structure to select only the relevant links from a given page.</p>
<h4><a class="anchor" aria-hidden="true" id="structure-of-a-pseudo-url"></a><a href="#structure-of-a-pseudo-url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Structure of a pseudo-URL</h4>
<p>Pseudo-URL is a URL with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener">regular expressions</a>) enclosed
in <code>[]</code> brackets. Since we're running Node.js, the regular expressions should follow the JavaScript style.</p>
<p>For example, a pseudo-URL</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories<span class="token operator">/</span><span class="token punctuation">[</span><span class="token punctuation">(</span>\w<span class="token operator">|</span><span class="token operator">-</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">]</span>
</code></pre>
<p>will match all of the following URLs:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories<span class="token operator">/</span>computers
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories<span class="token operator">/</span>mobile<span class="token operator">-</span>phones
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories<span class="token operator">/</span>black<span class="token operator">-</span>friday
</code></pre>
<p>but it will not match</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>categories
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">613804</span>
</code></pre>
<p>This way, you can easily find just the URLs that you're looking for while ignoring the rest.</p>
<p>A pseudo-URL may include any number of bracketed regular expressions, so you can compose much more complex matching logic. The following Pseudo URL
will match the items in the store even if the links use the non-secure <code>http</code> protocol, omit the <code>www</code> from the hostname or use different TLD.</p>
<pre><code class="hljs">http<span class="token punctuation">[</span>s<span class="token operator">?</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token punctuation">(</span>www<span class="token punctuation">)</span><span class="token operator">?</span>\<span class="token punctuation">.</span><span class="token punctuation">]</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span><span class="token punctuation">[</span>com<span class="token operator">|</span>net<span class="token operator">|</span>org<span class="token punctuation">]</span><span class="token operator">/</span>items<span class="token operator">/</span><span class="token punctuation">[</span>\d<span class="token operator">+</span><span class="token punctuation">]</span>
</code></pre>
<p>will match any combination of:</p>
<pre><code class="hljs">http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>org<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">12345</span>
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">633423</span>
http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>net<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">7003</span>
</code></pre>
<p>but it will not match:</p>
<pre><code class="hljs">http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>shop<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>org<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">12345</span>
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>com<span class="token operator">/</span>items<span class="token operator">/</span>calculator
www<span class="token punctuation">.</span>online<span class="token operator">-</span>store<span class="token punctuation">.</span>org<span class="token operator">/</span>items<span class="token operator">/</span><span class="token number">7003</span>
</code></pre>
<blockquote>
<p>Pssst! Don't tell anyone, but you can create <code>PseudoUrls</code> with plain old <code>RegExp</code> instances instead of this brackety madness as well.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="using-enqueuelinks-to-filter-links"></a><a href="#using-enqueuelinks-to-filter-links" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using <code>enqueueLinks()</code> to filter links</h4>
<p>That's been quite a lot of theory and examples. We might as well put it to practice. Going back to our <code>CheerioCrawler</code> exercise, we still have number
2 left to cross off the list - filter links pointing to <code>apify.com</code>. We've already shown that at the very least, the <code>enqueueLinks()</code> function needs
two arguments. The source, in our case the <code>$</code> object, and the destination - the <code>requestQueue</code>. To filter links, we need to add a third argument:
<code>pseudoUrls</code>.</p>
<p>The <code>options.pseudoUrls</code> argument is always an <code>Array</code>, but its contents can take on many forms. <a href="../api/utils#enqueueLinks">See the reference</a>
for all of them. Since we just need to filter out same domain links, we'll keep it simple and use a pseudo-URL <code>string</code>.</p>
<pre><code class="hljs css language-js"><span class="token comment">// Assuming previous existence of the '$' and 'requestQueue' variables.</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">,</span>
    requestQueue<span class="token punctuation">,</span>
    pseudoUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'http[s?]://apify.com[.*]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>To break the pseudo-URL string down, we're looking for both <code>http</code> and <code>https</code> protocols and the links may only lead to <code>apify.com</code> domain. The
final brackets <code>[.*]</code> allow everything, so <code>apify.com/contact</code> as well as <code>apify.com/store</code> will match. If this is complex to you, we suggest
<a href="https://www.regular-expressions.info/tutorial.html" target="_blank" rel="noopener">reading a tutorial</a> or two on regular expression syntax.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="resolving-relative-urls-with-enqueuelinks"></a><a href="#resolving-relative-urls-with-enqueuelinks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Resolving relative URLs with <code>enqueueLinks()</code></h4>
<p><strong>TLDR;</strong> Just use <code>baseUrl: request.loadedUrl</code> when working with <code>CheerioCrawler</code>.</p>
<p>This is probably the weirdest and most complicated addition to the list. This is not the place to talk at length about
<a href="https://stackoverflow.com/questions/2005079/absolute-vs-relative-urls" target="_blank" rel="noopener">absolute and relative paths</a>, but in short, the
links we encounter in a page can either be absolute, such as:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>john<span class="token operator">-</span>doe<span class="token operator">/</span>my<span class="token operator">-</span>actor
</code></pre>
<p>or relative:</p>
<pre><code class="hljs"><span class="token punctuation">.</span><span class="token operator">/</span>john<span class="token operator">-</span>doe<span class="token operator">/</span>my<span class="token operator">-</span>actor
</code></pre>
<p>Browsers handle this automatically, but since we're only using plain HTTP requests, we need to tell the <code>enqueueLinks()</code> function how to resolve the
relative links to the absolute ones, so we can use them for scraping. This is where the <code>request.loadedUrl</code> comes into play, because it returns the
correct URL to use as <code>baseUrl</code>.</p>
<pre><code class="hljs css language-js"><span class="token comment">// Assuming previous existence of the '$', 'requestQueue' and 'request' variables.</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">,</span>
    requestQueue<span class="token punctuation">,</span>
    pseudoUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'http[s?]://apify.com[.*]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>Even though it seems possible, we can't use the <code>request.url</code> of our <code>Request</code> instances, because the page could have been redirected and the final
URL would be different from the one we requested.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="integrating-enqueuelinks-into-our-crawler"></a><a href="#integrating-enqueuelinks-into-our-crawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integrating <code>enqueueLinks()</code> into our crawler</h4>
<p>That was fairly easy, wasn't it. That ticks the number 2 off our list and we're done! Let's take a look at the original crawler code, where we
enqueued all the links manually.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">URL</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;------ This is new.</span>
<span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Here starts the new part of handlePageFunction.</span>
        <span class="token keyword">const</span> links <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> ourDomain <span class="token operator">=</span> <span class="token string">'https://apify.com'</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> absoluteUrls <span class="token operator">=</span> links<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">link</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>link<span class="token punctuation">,</span> ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> sameDomainLinks <span class="token operator">=</span> absoluteUrls<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=></span> url<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>ourDomain<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Enqueueing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sameDomainLinks<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> URLs.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> url <span class="token keyword">of</span> sameDomainLinks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> url<span class="token punctuation">.</span>href <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// &lt;------ This is new too.</span>
        requestQueue<span class="token punctuation">,</span>
        handlePageFunction<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Since we've already prepared the <code>enqueueLinks()</code> options, we can just replace all the above enqueuing logic with a single function call, as promised.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    utils<span class="token operator">:</span> <span class="token punctuation">{</span> enqueueLinks <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> Apify<span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> requestQueue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'https://apify.com'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> request<span class="token punctuation">,</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The title of "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">" is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Enqueue links</span>
        <span class="token keyword">const</span> enqueued <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            $<span class="token punctuation">,</span>
            requestQueue<span class="token punctuation">,</span>
            pseudoUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'http[s?]://apify.com[.*]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Enqueued </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>enqueued<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> URLs.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span>
        handlePageFunction<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>And that's it! No more parsing the links from HTML using Cheerio, filtering them and enqueueing them one by one It all gets done automatically!
<code>enqueueLinks()</code> is just one example of Apify SDK's powerful helper functions. They're all designed to make your life easier so you can focus on
getting your data, while leaving the mundane crawling management to your tools.</p>
<p><code>Apify.utils.enqueueLinks()</code> has a lot more tricks up its sleeve. Make sure to check out the
<a href="../api/utils#enqueueLinks">reference documentation</a> to see what else it can do for you. Namely the feature to prepopulate the <code>Request</code>
instances it creates with <code>userData</code> of your choice is extremely useful!</p>
<h2><a class="anchor" aria-hidden="true" id="getting-some-real-world-data"></a><a href="#getting-some-real-world-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Getting some real world data</h2>
<blockquote>
<p>Hey, guys, you know, it's cool that we can scrape the <code>&lt;title&gt;</code> elements of web pages, but that's not very useful. Can we finally scrape some real
data and save it somewhere in a machine readable format? Because that's why started reading this tutorial in the first place!</p>
</blockquote>
<p>We hear you young padawan! First, learn how to crawl, you must. Only then, walk through data, you can!</p>
<h3><a class="anchor" aria-hidden="true" id="making-a-store-crawler"></a><a href="#making-a-store-crawler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making a store crawler</h3>
<p>Fortunately, we don't have to travel to a galaxy far far away to find a good candidate for learning how to scrape
structured data. The <a href="https://apify.com/store" target="_blank" rel="noopener">Apify Store</a> is a store of public actors that anyone can grab and use. You
can find ready-made solutions for crawling <a href="https://apify.com/drobnikj/crawler-google-places" target="_blank" rel="noopener">Google Places</a>,
<a href="https://apify.com/vaclavrut/amazon-crawler" target="_blank" rel="noopener">Amazon</a>,
<a href="https://apify.com/apify/google-search-scraper" target="_blank" rel="noopener">Google Search</a>,
<a href="https://apify.com/dtrungtin/booking-scraper" target="_blank" rel="noopener">Booking</a>,
<a href="https://apify.com/jaroslavhejlek/instagram-scraper" target="_blank" rel="noopener">Instagram</a>,
<a href="https://apify.com/maxcopell/tripadvisor" target="_blank" rel="noopener">Tripadvisor</a> and many other websites. Feel free to check them out! It
also poses a great place to practice our jedi scraping skills since it has categories, lists and details. That's almost like our imaginary
<code>online-store.com</code> from the previous chapter.</p>
<h3><a class="anchor" aria-hidden="true" id="the-importance-of-having-a-plan"></a><a href="#the-importance-of-having-a-plan" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The importance of having a plan</h3>
<p>Sometimes scraping is really straightforward, but most of the times, it really pays out to do a little bit of research first. How is the website
structured? Can I scrape it only with HTTP requests (read &quot;with <code>CheerioCrawler</code>&quot;) or would I need a full browser solution? Are there any
anti-scraping protections in place? Do I need to parse the HTML or can I get the data otherwise, such as directly from the website's API. Jakub,
one of Apify's founders wrote a
<a href="https://blog.apify.com/web-scraping-in-2018-forget-html-use-xhrs-metadata-or-javascript-variables-8167f252439c" target="_blank" rel="noopener">great article about all the different techniques</a>
and tips and tricks so make sure to check that out!</p>
<p>For the purposes of this tutorial, let's just go ahead with HTTP requests and HTML parsing using <code>CheerioCrawler</code>. The number one reason being: We
already know how to use it and we want to build on that knowledge to learn specific crawling and scraping techniques.</p>
<h4><a class="anchor" aria-hidden="true" id="choosing-the-data-we-need"></a><a href="#choosing-the-data-we-need" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Choosing the data we need</h4>
<p>A good first step is always to figure out what it is we want to scrape and where to find it. For the time being, let's just agree that we want to
scrape all actors (see the <code>Show</code> dropdown) in all categories (which can be found on the left side of the page) and for each actor we want to get its</p>
<ol>
<li>URL</li>
<li>Owner</li>
<li>Unique identifier (such as <code>apify/web-scraper</code>)</li>
<li>Title</li>
<li>Description</li>
<li>Last modification date</li>
<li>Number of runs</li>
</ol>
<p>We can see that some of the information is available directly on the list page, but for details such as &quot;Last modification date&quot; or &quot;Number of runs&quot; we'll need
to open the actor detail pages too.</p>
<p><img src="/img/getting-started/scraping-practice.jpg" alt="data to scrape" title="Overview of data to be scraped."></p>
<h4><a class="anchor" aria-hidden="true" id="analyzing-the-target"></a><a href="#analyzing-the-target" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Analyzing the target</h4>
<p>Knowing that we will use plain HTTP requests, we immediately know that we won't be able to manipulate the website in any way. We will only be able to
go through the HTML it gives us and parse our data from there. This might sound like a huge limitation, but you might be surprised in how effective it
might be. Let's get on it!</p>
<h4><a class="anchor" aria-hidden="true" id="the-start-urls"></a><a href="#the-start-urls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The start URL(s)</h4>
<p>This is where we start our crawl. It's convenient to start as close to our data as possible. For example, it wouldn't make much sense to start at
<code>apify.com</code> and look for a <code>store</code> link there, when we already know that everything we want to extract can be found at the <code>apify.com/store</code> page.</p>
<p>Once we look at the <code>apify.com/store</code> page more carefully though, we see that the categories themselves produce URLs that we can use to access those
individual categories.</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>store<span class="token operator">?</span>category<span class="token operator">=</span><span class="token constant">ENTERTAINMENT</span>
</code></pre>
<p>Should we write down all the category URLs down and use all of them as start URLs? It's definitely possible, but what if a new category appears on the
page later? We would not learn about it unless we manually visit the page and inspect it again. So scraping the category links off the store page
definitely makes sense. This way we always get an up to date list of categories.</p>
<p>But is it really that straightforward? By digging further into the store page's HTML we find that it does not actually contain the category links. The
menu on the left uses JavaScript to display the items from a given category and, as we've learned earlier, <code>CheerioCrawler</code> cannot execute JavaScript.</p>
<blockquote>
<p>We've deliberately chosen this scenario to show an example of the number one weakness of <code>CheerioCrawler</code>. We will overcome this difficulty in our
<code>PuppeteerCrawler</code> tutorial, but at the cost of compute resources and speed. Always remember that no tool is best for everything!</p>
</blockquote>
<p>So we're back to the pre-selected list of URLs. Since we cannot scrape the list dynamically, we have to manually collect the links and then use them
in our crawler. We lose the ability to scrape new categories, but we keep the low resource consumption and speed advantages of <code>CheerioCrawler</code>.</p>
<p>Therefore, after careful consideration, we've determined that we should use multiple start URLs and that they should look as follows:</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>store<span class="token operator">?</span>category<span class="token operator">=</span><span class="token constant">TRAVEL</span>
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>store<span class="token operator">?</span>category<span class="token operator">=</span><span class="token constant">ECOMMERCE</span>
https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>store<span class="token operator">?</span>category<span class="token operator">=</span><span class="token constant">ENTERTAINMENT</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="the-crawling-strategy"></a><a href="#the-crawling-strategy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The crawling strategy</h3>
<p>Now that we know where to start, we need to figure out where to go next. Since we've eliminated one level of crawling by selecting the categories
manually, we only need to crawl the actor detail pages now. The algorithm therefore follows:</p>
<ol>
<li>Visit the category list page (one of our start URLs).</li>
<li>Enqueue all links to actor details.</li>
<li>Visit all actor details and extract data.</li>
<li>Repeat 1 - 3 for all categories.</li>
</ol>
<blockquote>
<p>Technically, this is a depth first crawl and the crawler will perform a breadth first crawl by default, but that's an implementation detail. We've
chosen this notation since a breadth first crawl would be less readable.</p>
</blockquote>
<p><code>CheerioCrawler</code> will make sure to visit the pages for us, if we provide the correct <code>Requests</code> and we already know how to enqueue pages, so this
should be fairly easy. Nevertheless, there are two more tricks that we'd like to show you.</p>
<h4><a class="anchor" aria-hidden="true" id="using-a-requestlist"></a><a href="#using-a-requestlist" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a <code>RequestList</code></h4>
<p><code>RequestList</code> is a perfect tool for scraping a pre-existing list of URLs and if you think about our start URLs, this is exactly what we have! A list
of links to the different categories of the store. Let's see how we'd get them into a <code>RequestList</code>.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> sources <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'https://apify.com/store?category=TRAVEL'</span><span class="token punctuation">,</span>
    <span class="token string">'https://apify.com/store?category=ECOMMERCE'</span><span class="token punctuation">,</span>
    <span class="token string">'https://apify.com/store?category=ENTERTAINMENT'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>As you can see, similarly to the <code>Apify.openRequestQueue()</code> function, there is an <code>Apify.openRequestList()</code> function that will create a <code>RequestList</code>
instance for you. The first argument is a name of the <code>RequestList</code>. It is used to persist the crawling state of the list. This is useful when you
want to continue where you left off after an error or a process restart. The second argument is the <code>sources</code> array, which is nothing more than a list
of URLs you wish to crawl.</p>
<blockquote>
<p><code>RequestQueue</code> is a persistent store by default, so no name is needed, while the <code>RequestList</code> only lives in memory and giving it a name enables it
to become persistent.</p>
</blockquote>
<p>You might now want to ask one of the below questions:</p>
<ul>
<li>Can I enqueue into <code>RequestList</code> too?</li>
<li>How do I make <code>RequestList</code> work together with <code>RequestQueue</code> since I need the queue to enqueue new <code>Requests</code>.</li>
</ul>
<p>The answer to the first one is a definitive no. <code>RequestList</code> is immutable and once you create it, you cannot add or remove <code>Requests</code> from it. The
answer to the second one is simple. <code>RequestList</code> and <code>RequestQueue</code> are made to work together out of the box in crawlers, so all you need to do is
use them both and the crawlers will do the rest.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    requestList<span class="token punctuation">,</span>
    requestQueue<span class="token punctuation">,</span>
    handlePageFunction<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>For those wondering how this works, the <code>RequestList</code> <code>Requests</code> are enqueued into the <code>RequestQueue</code> right before their execution and only
processed by the <code>RequestQueue</code> afterwards. You can, of course, enqueue the <code>Requests</code> to the queue manually, but that would take some boilerplate
code and perhaps quite a long time, if we were talking about tens of thousands or more <code>Requests</code>. The crawlers do it while running, so the time to
enqueue is spread out and you won't even notice it.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="sanity-check"></a><a href="#sanity-check" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sanity check</h4>
<p>It's always useful to create some simple boilerplate code to see that we've got everything set up correctly before we start to write
the scraping logic itself. We might realize that something in our previous analysis doesn't quite add up, or the website might not behave exactly the
same as we expected.</p>
<p>Let's use the newly acquired <code>RequestList</code> knowledge and everything we know from the previous chapters to create a new crawler that'll just visit all
the category URLs we selected and print the text content of all the actors in the category. Try running the code below in your selected environment.
You should see, albeit very badly formatted, the text of the individual actor cards that are displayed in the selected categories.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sources <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'https://apify.com/store?category=TRAVEL'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ECOMMERCE'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ENTERTAINMENT'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        requestList<span class="token punctuation">,</span>
        <span class="token function-variable function">handlePageFunction</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token comment">// Select all the actor cards.</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ITEM: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>If there's anything you don't understand, refer to the previous chapters on setting up your environment, building your first crawler and
<code>CheerioCrawler</code>.</p>
</blockquote>
<p>You might be wondering how we got that <code>.item</code> selector. After analyzing the category pages using a browser's DevTools, we've determined that it's a
good selector to select all the currently displayed actor cards. DevTools and CSS selectors are quite a large topic, so we can't go into too much
detail here, but here are a few general pointers.</p>
<h4><a class="anchor" aria-hidden="true" id="devtools-crash-course"></a><a href="#devtools-crash-course" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DevTools crash course</h4>
<blockquote>
<p>We'll use Chrome DevTools here, since it's the most common browser, but feel free to use any other, it's all very similar.</p>
</blockquote>
<p>We could pick any category, but let's just go with Travel because it includes some interesting actors. Go to</p>
<pre><code class="hljs">https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>apify<span class="token punctuation">.</span>com<span class="token operator">/</span>store<span class="token operator">?</span>category<span class="token operator">=</span><span class="token constant">TRAVEL</span>
</code></pre>
<p>and open DevTools either by right clicking anywhere in the page and selecting <code>Inspect</code>, or by pressing <code>F12</code> or by any other means relevant to your
system. Once you're there, you'll see a bunch of DevToolsy stuff and a view of the category page with the individual actor cards.</p>
<p>Now, find the <code>Select an element</code> tool and use it to select one of the actor cards. Make sure to select the whole card, not some of its contents, such
as its title or description.</p>
<p>In the resulting HTML display, it will put your cursor somewhere. Inspect the HTML around it. You'll see that there are CSS classes attached to the
different HTML elements.</p>
<p>By hovering over the individual elements, you will see their placement in the page's view. It's easy to see the page's structure around the actor
cards now. All the cards are displayed in a <code>&lt;div&gt;</code> with a classname that starts with <code>ItemsGrid__StyledDiv</code>, which holds another <code>&lt;div&gt;</code> with some
computer generated class names and finally, inside this <code>&lt;div&gt;</code>, the individual cards are represented by other <code>&lt;div&gt;</code> elements with the class of
<code>item</code>.</p>
<blockquote>
<p>Yes, there are other HTML elements and other classes too. We can safely ignore them.</p>
</blockquote>
<p>It should now make sense how we got that <code>.item</code> selector. It's just a selector that finds all elements that are annotated with the <code>item</code> class and
those just happen to be the actor cards only.</p>
<p>It's always a good idea to double check that though, so go into the DevTools Console and run</p>
<pre><code class="hljs css language-js">document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>You will see that only the actor cards will be returned, and nothing else.</p>
<h4><a class="anchor" aria-hidden="true" id="enqueueing-the-detail-links-using-a-custom-selector"></a><a href="#enqueueing-the-detail-links-using-a-custom-selector" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enqueueing the detail links using a custom selector</h4>
<p>In the previous chapter, we've used the <code>Apify.utils.enqueueLinks()</code> function like this:</p>
<pre><code class="hljs css language-js"><span class="token keyword">await</span> <span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $<span class="token punctuation">,</span>
    requestQueue<span class="token punctuation">,</span>
    pseudoUrls<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'http[s?]://apify.com[.*]'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>While very useful in that scenario, we need something different now. Instead of finding all the <code>&lt;a href=&quot;..&quot;&gt;</code> links that match the <code>pseudoUrl</code>, we
need to find only the specific ones that will take us to the actor detail pages. Otherwise, we'd be visiting a lot of other pages that we're not
interested in. Using the power of DevTools and yet another <code>enqueueLinks()</code> parameter, this becomes fairly easy.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> <span class="token function-variable function">handlePageFunction</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Only enqueue new links from the category pages.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Apify<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            $<span class="token punctuation">,</span>
            requestQueue<span class="token punctuation">,</span>
            selector<span class="token operator">:</span> <span class="token string">'div.item > a'</span><span class="token punctuation">,</span>
            baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
            <span class="token function-variable function">transformRequestFunction</span><span class="token operator">:</span> <span class="token parameter">req</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                req<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> req<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The code should look pretty familiar to you. It's a very simple <code>handlePageFunction</code> where we log the currently processed URL to the console and
enqueue more links. But there are also a few new, interesting additions. Let's break it down.</p>
<h5><a class="anchor" aria-hidden="true" id="the-selector-parameter-of-enqueuelinks"></a><a href="#the-selector-parameter-of-enqueuelinks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The <code>selector</code> parameter of <code>enqueueLinks()</code></h5>
<p>When we previously used <code>enqueueLinks()</code>, we were not providing any <code>selector</code> parameter and it was fine, because we wanted to use the default
setting, which is <code>a</code> - finds all <code>&lt;a&gt;</code> elements. But now, we need to be more specific. There are multiple <code>&lt;a&gt;</code> links on the given category page, but
we're only interested in those that will take us to item (actor) details. Using the DevTools, we found out that we can select the links we wanted
using the <code>div.item &gt; a</code> selector, which selects all the <code>&lt;a&gt;</code> elements that have a <code>&lt;div class=&quot;item ...&quot;&gt;</code> parent. And those are exactly the ones
we're interested in.</p>
<h5><a class="anchor" aria-hidden="true" id="the-missing-pseudourls"></a><a href="#the-missing-pseudourls" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The missing <code>pseudoUrls</code></h5>
<p>Earlier we've learned that <code>pseudoUrls</code> are not required and if omitted, all links matching the given <code>selector</code> will be enqueued. This is exactly
what we need, so we're skipping <code>pseudoUrls</code> this time. That does not mean that you can't use <code>pseudoUrls</code> together with a custom <code>selector</code> though,
because you absolutely can!</p>
<h5><a class="anchor" aria-hidden="true" id="finally-the-userdata-of-enqueuelinks"></a><a href="#finally-the-userdata-of-enqueuelinks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finally, the <code>userData</code> of <code>enqueueLinks()</code></h5>
<p>You will see <code>userData</code> used often throughout Apify SDK and it's nothing more than a place to store your own data on a <code>Request</code> instance. You can
access it by <code>request.userData</code> and it's a plain <code>Object</code> that can be used to store anything that needs to survive the full life-cycle of the
<code>Request</code>.</p>
<p>We can use the <code>transformRequestFunction</code> option of <code>enqueueLinks()</code> to modify all the <code>Request</code> instances it creates and enqueues. In our case, we
use it to set a <code>detailPage</code> property to the enqueued <code>Requests</code> to be able to easily differentiate between the category pages and the detail pages.</p>
<h4><a class="anchor" aria-hidden="true" id="another-sanity-check"></a><a href="#another-sanity-check" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Another sanity check</h4>
<p>It's always good to work step by step. We have this new enqueueing logic in place and since the previous <a href="#sanity-check">Sanity check</a> worked only
with a <code>RequestList</code>, because we were not enqueueing anything so don't forget to add back the <code>RequestQueue</code> and <code>maxRequestsPerCrawl</code> limit. Let's
test it out!</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sources <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'https://apify.com/store?category=TRAVEL'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ECOMMERCE'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ENTERTAINMENT'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;----------------</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token comment">// &lt;----------------------------------------</span>
        requestList<span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span> <span class="token comment">// &lt;---------------------------------------------------</span>
        <span class="token function-variable function">handlePageFunction</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Only enqueue new links from the category pages.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> Apify<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    $<span class="token punctuation">,</span>
                    requestQueue<span class="token punctuation">,</span>
                    selector<span class="token operator">:</span> <span class="token string">'div.item > a'</span><span class="token punctuation">,</span>
                    baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
                    <span class="token function-variable function">transformRequestFunction</span><span class="token operator">:</span> <span class="token parameter">req</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        req<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> req<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>We've added the <code>handlePageFunction()</code> with the <code>enqueueLinks()</code> logic from the previous section to the code we've written earlier. As always, try
running it in an environment of your choice. You should see the crawler output a number of links to the console, as it crawls the category pages first
and then all the links to the actor detail pages it found.</p>
<p>This concludes our Crawling strategy section, because we have taught the crawler to visit all the pages we need. Let's continue with scraping the
tasty data.</p>
<h3><a class="anchor" aria-hidden="true" id="scraping-data"></a><a href="#scraping-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scraping data</h3>
<p>At the beginning of this chapter, we've created a list of information we wanted to collect about the actors in the store. Let's review that and figure
out ways to access it.</p>
<ol>
<li>URL</li>
<li>Owner</li>
<li>Unique identifier (such as <code>apify/web-scraper</code>)</li>
<li>Title</li>
<li>Description</li>
<li>Last modification date</li>
<li>Number of runs</li>
</ol>
<p><img src="/img/getting-started/scraping-practice.jpg" alt="data to scrape" title="Overview of data to be scraped."></p>
<h4><a class="anchor" aria-hidden="true" id="scraping-the-url-owner-and-unique-identifier"></a><a href="#scraping-the-url-owner-and-unique-identifier" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scraping the URL, Owner and Unique identifier</h4>
<p>Some information is lying right there in front of us without even having to touch the actor detail pages. The <code>URL</code> we already have - the
<code>request.url</code>. And by looking at it carefully, we realize that it already includes the <code>owner</code> and the <code>unique identifier</code> too. We can just split the
<code>string</code> and be on our way then!</p>
<pre><code class="hljs css language-js"><span class="token comment">// request.url = https://apify.com/apify/web-scraper</span>

<span class="token keyword">const</span> urlArr <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['apify', 'web-scraper']</span>
<span class="token keyword">const</span> uniqueIdentifier <span class="token operator">=</span> urlArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'apify/web-scraper'</span>
<span class="token keyword">const</span> owner <span class="token operator">=</span> urlArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 'apify'</span>
</code></pre>
<blockquote>
<p>It's always a matter of preference, whether to store this information separately in the resulting dataset, or not. Whoever uses the dataset can
easily parse the <code>owner</code> from the <code>URL</code>, so should we duplicate the data unnecessarily? Our opinion is that unless the increased data consumption
would be too large to bear, it's always better to make the dataset as readable as possible. Someone might want to filter by <code>owner</code> for example and
keeping only the <code>URL</code> in the dataset would make this complicated without using additional tools.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="scraping-title-description-last-modification-date-and-number-of-runs"></a><a href="#scraping-title-description-last-modification-date-and-number-of-runs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scraping Title, Description, Last modification date and Number of runs</h4>
<p>Now it's time to add more data to the results. Let's open one of the actor detail pages in the Store, for example the
<a href="https://apify.com/apify/web-scraper" target="_blank" rel="noopener"><code>apify/web-scraper</code></a> page and use our DevTools-Fu to figure out how to get the title of the actor.</p>
<h5><a class="anchor" aria-hidden="true" id="title"></a><a href="#title" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Title</h5>
<p><img src="/img/getting-started/title-01.jpg" alt="actor title" title="Finding actor title in DevTools."></p>
<p>By using the element selector tool, we find out that the title is there under an <code>&lt;h1&gt;</code> tag, as titles should be.
Maybe surprisingly, we find that there are actually two <code>&lt;h1&gt;</code> tags on the detail page. This should get us thinking.
Is there any parent element that includes our <code>&lt;h1&gt;</code> tag, but not the other ones? Yes, there is! There is a <code>&lt;header&gt;</code>
element that we can use to select only the heading we're interested in.</p>
<blockquote>
<p>Remember that you can press CTRL+F (CMD+F) in the Elements tab of DevTools to open the search bar where you can quickly search for elements using
their selectors. And always make sure to use the DevTools to verify your scraping process and assumptions. It's faster than changing the crawler
code all the time.</p>
</blockquote>
<p>To get the title we just need to find it using <code>Cheerio</code> and a <code>header h1</code> selector, which selects all <code>&lt;h1&gt;</code> elements that have a <code>&lt;header&gt;</code> ancestor.
And as we already know, there's only one.</p>
<pre><code class="hljs css language-js"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="description"></a><a href="#description" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Description</h5>
<p>Getting the actor's description is a little more involved, but still pretty straightforward. We can't just simply search for a <code>&lt;p&gt;</code> tag, because
there's a lot of them in the page. We need to narrow our search down a little. Using the DevTools we find that the actor description is nested within
the <code>&lt;header&gt;</code> element too, same as the title. Moreover, the actual description is nested inside a <code>&lt;span&gt;</code> tag with a class <code>actor-description</code>.</p>
<p><img src="/img/getting-started/description.jpg" alt="actor description selector" title="Finding actor description in DevTools."></p>
<pre><code class="hljs css language-js"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h5><a class="anchor" aria-hidden="true" id="last-modification-date"></a><a href="#last-modification-date" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Last modification date</h5>
<p>The DevTools tell us that the <code>modifiedDate</code> can be found in the <code>&lt;time&gt;</code> element inside <code>&lt;ul class=&quot;ActorHeader-stats&quot;&gt;</code>.</p>
<p><img src="/img/getting-started/modified-date.jpg" alt="actor last modification date selector" title="Finding actor last modification date in DevTools."></p>
<pre><code class="hljs css language-js"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
        <span class="token function">Number</span><span class="token punctuation">(</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>It might look a little too complex at first glance, but let me walk you through it. We find the right <code>&lt;time&gt;</code> element,
and then we read its <code>datetime</code> attribute, because that's where a unix timestamp is stored as a <code>string</code>.</p>
<p>But we would much rather see a readable date in our results, not a unix timestamp, so we need to convert it. Unfortunately the <code>new Date()</code>
constructor will not accept a <code>string</code>, so we cast the <code>string</code> to a <code>number</code> using the <code>Number()</code> function before actually calling <code>new Date()</code>.
Phew!</p>
<h5><a class="anchor" aria-hidden="true" id="run-count"></a><a href="#run-count" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run count</h5>
<p>And so we're finishing up with the <code>runCount</code>. There's no specific element like <code>&lt;time&gt;</code>, so we need to create a complex selector and then do a
transformation on the result.</p>
<pre><code class="hljs css language-js"><span class="token keyword">return</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
        <span class="token function">Number</span><span class="token punctuation">(</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    runCount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats > li:nth-of-type(3)'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\d,]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>The <code>ul.ActorHeader-stats &gt; li:nth-of-type(3)</code> looks complicated, but it only reads that we're looking for a <code>&lt;ul class=&quot;ActorHeader-stats ...&quot;&gt;</code> element and within that
element we're looking for the third <code>&lt;li&gt;</code> element. We grab its text, but we're only interested in the number of runs. So we parse the number out
using a regular expression, but its type is still a <code>string</code>, so we finally convert the result to a <code>number</code> by wrapping it with a <code>Number()</code> call.</p>
<blockquote>
<p>The numbers are formatted with commas as thousands separators (e.g. <code>'1,234,567'</code>), so to extract it, we
first use regular expression <code>/[\d,]+/</code> - it will search for consecutive number or comma characters.
Then we extract the match via <code>.match(/[\d,]+/)[0]</code> and finally remove the commas by calling <code>.replace(',', '')</code>.
This will give us a string (e.g. <code>'1234567'</code>) that can be converted via <code>Number</code> function.</p>
</blockquote>
<p>And there we have it! All the data we needed in a single object. For the sake of completeness, let's add the properties we parsed from the URL earlier
and we're good to go.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> urlArr <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">{</span>
    url<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    uniqueIdentifier<span class="token operator">:</span> urlArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    owner<span class="token operator">:</span> urlArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
        <span class="token function">Number</span><span class="token punctuation">(</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    runCount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats > li:nth-of-type(3)'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\d,]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'RESULTS: '</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="trying-it-out-sanity-check-3"></a><a href="#trying-it-out-sanity-check-3" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Trying it out (sanity check #3)</h4>
<p>We have everything we need so just grab our newly created scraping logic, dump it into our original <code>handlePageFunction()</code> and see the magic!</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sources <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'https://apify.com/store?category=TRAVEL'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ECOMMERCE'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ENTERTAINMENT'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        requestList<span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span>
        <span class="token function-variable function">handlePageFunction</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// This is our new scraping logic.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> urlArr <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">{</span>
                    url<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
                    uniqueIdentifier<span class="token operator">:</span> urlArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    owner<span class="token operator">:</span> urlArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
                        <span class="token function">Number</span><span class="token punctuation">(</span>
                            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    runCount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>
                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats > li:nth-of-type(3)'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\d,]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'RESULTS'</span><span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Only enqueue new links from the category pages.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> Apify<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    $<span class="token punctuation">,</span>
                    requestQueue<span class="token punctuation">,</span>
                    selector<span class="token operator">:</span> <span class="token string">'div.item > a'</span><span class="token punctuation">,</span>
                    baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
                    <span class="token function-variable function">transformRequestFunction</span><span class="token operator">:</span> <span class="token parameter">req</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        req<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> req<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<blockquote>
<p>Notice again that we're scraping on the detail pages <code>request.userData.detailPage === true</code>, but we're only enqueueing on the category pages
<code>request.userData.detailPage === undefined</code>.</p>
</blockquote>
<p>When running the actor in an environment of your choice, you should see the crawled URLs and their scraped data printed to the console.</p>
<h3><a class="anchor" aria-hidden="true" id="saving-the-scraped-data"></a><a href="#saving-the-scraped-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Saving the scraped data</h3>
<p>A data extraction job would not be complete without saving the data for later use and processing. We've come to the final and most difficult part of
this chapter so make sure to pay attention very carefully!</p>
<p>First, replace the <code>console.log('RESULTS', results)</code> call with</p>
<pre><code class="hljs css language-js"><span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>and that's it. Unlike in the previous paragraph, I'm serious now. That's it, we're done. The final code therefore looks exactly like this:</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> sources <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'https://apify.com/store?category=TRAVEL'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ECOMMERCE'</span><span class="token punctuation">,</span>
        <span class="token string">'https://apify.com/store?category=ENTERTAINMENT'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        maxRequestsPerCrawl<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        requestList<span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span>
        <span class="token function-variable function">handlePageFunction</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// This is our new scraping logic.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> urlArr <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">{</span>
                    url<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
                    uniqueIdentifier<span class="token operator">:</span> urlArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    owner<span class="token operator">:</span> urlArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
                        <span class="token function">Number</span><span class="token punctuation">(</span>
                            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    runCount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>
                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats > li:nth-of-type(3)'</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\d,]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Only enqueue new links from the category pages.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">await</span> Apify<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    $<span class="token punctuation">,</span>
                    requestQueue<span class="token punctuation">,</span>
                    selector<span class="token operator">:</span> <span class="token string">'div.item > a'</span><span class="token punctuation">,</span>
                    baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
                    <span class="token function-variable function">transformRequestFunction</span><span class="token operator">:</span> <span class="token parameter">req</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        req<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>detailPage <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> req<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="whats-apifypushdata"></a><a href="#whats-apifypushdata" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What's <code>Apify.pushData()</code></h4>
<p><a href="../api/apify#pushdata"><code>Apify.pushData()</code></a> is a helper function that saves data to the default <a href="../api/dataset"><code>Dataset</code></a>. <code>Dataset</code> is a
storage designed to hold virtually unlimited amount of data in a format similar to a table. Each time you call <code>Apify.pushData()</code> a new row in the
table is created, with the property names serving as column titles.</p>
<blockquote>
<p>Each actor run has one default <code>Dataset</code> so no need to initialize it or create an instance first. It just gets done automatically for you. You can
also create named datasets at will.</p>
</blockquote>
<h4><a class="anchor" aria-hidden="true" id="finding-my-saved-data"></a><a href="#finding-my-saved-data" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finding my saved data</h4>
<p>It might not be perfectly obvious where the data we saved using the previous command went, so let's break it down by environment:</p>
<h5><a class="anchor" aria-hidden="true" id="dataset-on-the-apify-platform"></a><a href="#dataset-on-the-apify-platform" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dataset on the Apify Platform</h5>
<p>Open any Run of your actor on the Platform and you will see a Dataset as one of the available tabs. Clicking on it will reveal basic information about
the Dataset and a list of options that you can use to download your data. There are various formats such as JSON, XLSX or CSV available and there's
also the possibility of downloading only Clean items, i.e. a filtered dataset with empty rows and hidden fields removed.</p>
<h5><a class="anchor" aria-hidden="true" id="local-dataset"></a><a href="#local-dataset" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local Dataset</h5>
<p>Unless you changed the environment variables that Apify SDK uses locally, which would suggest that you knew what you were doing and you didn't need
this tutorial anyway, you'll find your data in your local Apify Storage.</p>
<pre><code class="hljs"><span class="token punctuation">{</span><span class="token constant">PROJECT_FOLDER</span><span class="token punctuation">}</span><span class="token operator">/</span>apify_storage<span class="token operator">/</span>datasets<span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">/</span>
</code></pre>
<p>The above folder will hold all your saved data in numbered files, as they were pushed into the dataset. Each file represents one invocation of
<code>Apify.pushData()</code> or one table row.</p>
<blockquote>
<p>Unfortunately, the local datasets don't yet support the export in various formats functionality that the Platform Dataset page offers, so for the
time being, we're stuck with JSON.</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="final-touch"></a><a href="#final-touch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Final touch</h3>
<p>It may seem that the data are extracted and the actor is done, but honestly, this is just the beginning. For the sake of brevity, we've completely
omitted error handling, proxies, debug logging, tests, documentation and other stuff that a reliable software should have. The good thing is, <strong>error
handling is mostly done by Apify SDK itself</strong>, so no worries on that front, unless you need some custom magic.</p>
<p>Anyway, to spark some ideas, let's look at two more things. First, passing an input to the actor, which will enable us to change the categories we
want to scrape without changing the source code itself! And then some refactoring, to show you how we reckon is preferable to structure and annotate
actor code.</p>
<h4><a class="anchor" aria-hidden="true" id="meet-the-input"></a><a href="#meet-the-input" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Meet the <code>INPUT</code></h4>
<p><code>INPUT</code> is just a convention on how we call the actor's input. Because there's no magic in actors, just features, the <code>INPUT</code> is actually nothing more
than a key in the default <a href="../api/key-value-store"><code>KeyValueStore</code></a> that's, by convention, used as input on Apify Platform. Also by convention, the
<code>INPUT</code> is mostly expected to be of <code>Content-Type: application/json</code>.</p>
<p>We will not go into <code>KeyValueStore</code> details here, but for the sake of <code>INPUT</code> you need to remember that there is a function that helps you get it.</p>
<pre><code class="hljs css language-js"><span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>On the Apify Platform, the actor's input that you can set in the Console is automatically saved to the default <code>KeyValueStore</code> under the key <code>INPUT</code>
and by calling <a href="../api/apify#getvalue"><code>Apify.getInput()</code></a> you retrieve the value from the <code>KeyValueStore</code>.</p>
<p>Running locally, you need to place an <code>INPUT.json</code> file in your default key value store for this to work.</p>
<pre><code class="hljs"><span class="token punctuation">{</span><span class="token constant">PROJECT_FOLDER</span><span class="token punctuation">}</span><span class="token operator">/</span>apify_storage<span class="token operator">/</span>key_value_stores<span class="token operator">/</span><span class="token keyword">default</span><span class="token operator">/</span><span class="token constant">INPUT</span><span class="token punctuation">.</span>json
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="use-input-to-seed-our-actor-with-categories"></a><a href="#use-input-to-seed-our-actor-with-categories" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Use <code>INPUT</code> to seed our actor with categories</h4>
<p>Currently we're using the full URLs of categories as sources, but it's quite obvious that we only need the final parameters, the rest of the URL is
always the same. Knowing that, we can pass an array of those parameters on <code>INPUT</code> and build the URLs dynamically, which would allow us to scrape
different categories without changing the source code. Let's get to it!</p>
<p>First, we set up our <code>INPUT</code>, either in the <code>INPUT</code> form of the actor on Apify Platform, or by creating an <code>INPUT.json</code> in our default key value store
locally.</p>
<pre><code class="hljs css language-json"><span class="token punctuation">[</span><span class="token string">"TRAVEL"</span><span class="token punctuation">,</span> <span class="token string">"ECOMMERCE"</span><span class="token punctuation">,</span> <span class="token string">"ENTERTAINMENT"</span><span class="token punctuation">]</span>
</code></pre>
<p>Once we have that, we can load it in the actor and populate the crawler's sources with it. In the following example, we're using the categories in the
input to construct the category URLs and we're also passing custom <code>userData</code> to the sources. This means that the <code>Requests</code> that get created will
automatically contain this <code>userData</code>.</p>
<pre><code class="hljs css language-js"><span class="token comment">// ...</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sources <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">category</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://apify.com/store?category=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>category<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    userData<span class="token operator">:</span> <span class="token punctuation">{</span>
        label<span class="token operator">:</span> <span class="token string">'CATEGORY'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> sources<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
</code></pre>
<p>The <code>userData.label</code> is also a convention that we've been using for quite some time to label different <code>Requests</code>. We know that this is a category URL
so we <code>label</code> it <code>CATEGORY</code>. This way, we can easily make decisions in the <code>handlePageFunction</code> without having to inspect the URL itself.</p>
<p>We can then refactor the <code>if</code> clauses in the <code>handlePageFunction</code> to use the <code>label</code> for decision making. This does not make much sense for a crawler
with only two different pages, because a simple <code>boolean</code> would suffice, but for pages with multiple different views, it becomes very useful.</p>
<h4><a class="anchor" aria-hidden="true" id="structuring-the-code-better"></a><a href="#structuring-the-code-better" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Structuring the code better</h4>
<p>But perhaps we should not stop at refactoring the <code>if</code> clauses. There are several ways we can make the actor look more elegant and - most
importantly - easier to reason about and make changes to.</p>
<p>In the following code we've made several changes.</p>
<ul>
<li>Split the code into multiple files.</li>
<li>Added the <code>Apify.utils.log</code> and replaced <code>console.log</code> with it.</li>
<li>Added a <code>getSources()</code> function to encapsulate <code>INPUT</code> consumption.</li>
<li>Added a <code>createRouter()</code> function to make our routing cleaner, without nested <code>if</code> clauses.</li>
<li>Removed the <code>maxRequestsPerCrawl</code> limit.</li>
</ul>
<blockquote>
<p>To create a multi-file actor on the Apify Platform, select <strong>Multiple source files</strong> in the <strong>Type</strong> dropdown on the <strong>Source</strong> screen.</p>
</blockquote>
<p>In our <code>main.js</code> file, we place the general structure of the crawler:</p>
<pre><code class="hljs css language-js"><span class="token comment">// main.js</span>
<span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tools <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./tools'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    utils<span class="token operator">:</span> <span class="token punctuation">{</span> log <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> Apify<span class="token punctuation">;</span>

Apify<span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Starting actor.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> requestList <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestList</span><span class="token punctuation">(</span><span class="token string">'categories'</span><span class="token punctuation">,</span> <span class="token keyword">await</span> tools<span class="token punctuation">.</span><span class="token function">getSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> requestQueue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> router <span class="token operator">=</span> tools<span class="token punctuation">.</span><span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> requestQueue <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Setting up crawler.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> crawler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Apify<span class="token punctuation">.</span>CheerioCrawler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        requestList<span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span>
        <span class="token function-variable function">handlePageFunction</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token parameter">context</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> request <span class="token punctuation">}</span> <span class="token operator">=</span> context<span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Processing </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token function">router</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>label<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Starting the crawl.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> crawler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Actor finished.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Then in a separate <code>tools.js</code>, we add our helper functions:</p>
<pre><code class="hljs css language-js"><span class="token comment">// tools.js</span>
<span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    utils<span class="token operator">:</span> <span class="token punctuation">{</span> log <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> Apify<span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">getSources</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Getting sources.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> input<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">category</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://apify.com/store?category=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>category<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        userData<span class="token operator">:</span> <span class="token punctuation">{</span>
            label<span class="token operator">:</span> <span class="token string">'CATEGORY'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">createRouter</span> <span class="token operator">=</span> <span class="token parameter">globalContext</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">routeName<span class="token punctuation">,</span> requestContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> route <span class="token operator">=</span> routes<span class="token punctuation">[</span>routeName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>route<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">No route for name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invoking route: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routeName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">route</span><span class="token punctuation">(</span>requestContext<span class="token punctuation">,</span> globalContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>And finally our routes in a separate <code>routes.js</code> file:</p>
<pre><code class="hljs css language-js"><span class="token comment">// routes.js</span>
<span class="token keyword">const</span> Apify <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'apify'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
    utils<span class="token operator">:</span> <span class="token punctuation">{</span> log <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> Apify<span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">CATEGORY</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> requestQueue <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Apify<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">enqueueLinks</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        $<span class="token punctuation">,</span>
        requestQueue<span class="token punctuation">,</span>
        selector<span class="token operator">:</span> <span class="token string">'div.item > a'</span><span class="token punctuation">,</span>
        baseUrl<span class="token operator">:</span> request<span class="token punctuation">.</span>loadedUrl<span class="token punctuation">,</span>
        <span class="token function-variable function">transformRequestFunction</span><span class="token operator">:</span> <span class="token parameter">req</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            req<span class="token punctuation">.</span>userData<span class="token punctuation">.</span>label <span class="token operator">=</span> <span class="token string">'DETAIL'</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> req<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">DETAIL</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> $<span class="token punctuation">,</span> request <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> urlArr <span class="token operator">=</span> request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Scraping results.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">{</span>
        url<span class="token operator">:</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
        uniqueIdentifier<span class="token operator">:</span> urlArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        owner<span class="token operator">:</span> urlArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header h1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        description<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header span.actor-description'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        modifiedDate<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>
            <span class="token function">Number</span><span class="token punctuation">(</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats time'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datetime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        runCount<span class="token operator">:</span> <span class="token function">Number</span><span class="token punctuation">(</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul.ActorHeader-stats > li:nth-of-type(3)'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\d,]+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">'Pushing data to dataset.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>Let us tell you a little bit more about the changes. We're hopeful that in the end, you'll agree that this structure makes the actor more readable and
manageable.</p>
<h4><a class="anchor" aria-hidden="true" id="splitting-your-code-into-multiple-files"></a><a href="#splitting-your-code-into-multiple-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Splitting your code into multiple files</h4>
<p>It was not always the case, but now that Apify Platform has a multifile editor, there's no reason not to split your code into multiple files and keep
your logic separate. Less code in a single file means less code you need to think about at any time, and that's a great thing!</p>
<h4><a class="anchor" aria-hidden="true" id="using-apifyutilslog-instead-of-consolelog"></a><a href="#using-apifyutilslog-instead-of-consolelog" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using <code>Apify.utils.log</code> instead of <code>console.log</code></h4>
<p>We wont go into great lengths here to talk about <code>utils.log</code> here, because you can read <a href="../api/log">it all in the documentation</a>, but there's just
one thing that we need to stress: <strong>log levels</strong>.</p>
<p><code>utils.log</code> enables you to use different log levels, such as <code>log.debug</code>, <code>log.info</code> or <code>log.warning</code>. It not only makes your log more readable, but
it also allows selective turning off of some levels by either calling the <code>utils.log.setLevel()</code> function or by setting an <code>APIFY_LOG_LEVEL</code> variable.
This is huge! Because you can now add a lot of debug logs in your actor, which will help you when something goes wrong and turn them on or off with a
simple <code>INPUT</code> change, or by setting an environment variable.</p>
<p>The punch line? Use <code>Apify.utils.log</code> instead of <code>console.log</code> now and thank us later when something goes wrong!</p>
<h4><a class="anchor" aria-hidden="true" id="using-a-router-to-structure-your-crawling"></a><a href="#using-a-router-to-structure-your-crawling" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a router to structure your crawling</h4>
<p>At first, it might seem more readable using just a simple <code>if / else</code> statement to select different logic based on the crawled pages, but trust me, it
becomes far less impressive when working with more than 2 different pages and it definitely starts to fall apart when the logic to handle each page
spans tens or hundreds of lines of code.</p>
<p>It's a good practice in any programming to split your logic into bite sized chunks that are easy to read and reason about. Scrolling through a
thousand line long <code>handlePageFunction()</code> where everything interacts with everything and variables can be used everywhere is not a beautiful thing to
do and a pain to debug. That's why we prefer the separation of routes into a special file and with large routes, we would even suggest having one file
per route.</p>
<blockquote>
<p>TO BE CONTINUED with details on <code>PuppeteerCrawler</code> and other features...</p>
</blockquote>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/1.0.1/guides/apify-platform"><span class="arrow-prev">← </span><span>Apify Platform</span></a><a class="docs-next button" href="/docs/1.0.1/guides/request-storage"><span>Request Storage</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#intro">Intro</a></li><li><a href="#setting-up-locally">Setting up locally</a><ul class="toc-headings"><li><a href="#creating-a-new-project">Creating a new project</a></li></ul></li><li><a href="#setting-up-on-the-apify-platform">Setting up on the Apify Platform</a><ul class="toc-headings"><li><a href="#creating-a-new-project-1">Creating a new project</a></li></ul></li><li><a href="#first-crawler">First crawler</a><ul class="toc-headings"><li><a href="#the-general-idea">The general idea</a></li><li><a href="#the-where-request-requestlist-and-requestqueue">The Where - <code>Request</code>, <code>RequestList</code> and <code>RequestQueue</code></a></li><li><a href="#the-what-handlepagefunction">The What - <code>handlePageFunction</code></a></li><li><a href="#putting-it-all-together">Putting it all together</a></li></ul></li><li><a href="#cheeriocrawler-aka-jquery-crawler">CheerioCrawler aka jQuery crawler</a><ul class="toc-headings"><li><a href="#overview">Overview</a></li><li><a href="#when-to-use-cheeriocrawler">When to use <code>CheerioCrawler</code></a></li><li><a href="#basic-use-of-cheeriocrawler">Basic use of <code>CheerioCrawler</code></a></li></ul></li><li><a href="#using-apify-sdk-to-enqueue-links-like-a-boss">Using Apify SDK to enqueue links like a boss</a><ul class="toc-headings"><li><a href="#meet-apifyutils">Meet <code>Apify.utils</code></a></li><li><a href="#introduction-to-apifyutilsenqueuelinks">Introduction to <code>Apify.utils.enqueueLinks()</code></a></li><li><a href="#basic-use-of-enqueuelinks-with-cheeriocrawler">Basic use of <code>enqueueLinks()</code> with <code>CheerioCrawler</code></a></li></ul></li><li><a href="#getting-some-real-world-data">Getting some real world data</a><ul class="toc-headings"><li><a href="#making-a-store-crawler">Making a store crawler</a></li><li><a href="#the-importance-of-having-a-plan">The importance of having a plan</a></li><li><a href="#the-crawling-strategy">The crawling strategy</a></li><li><a href="#scraping-data">Scraping data</a></li><li><a href="#saving-the-scraped-data">Saving the scraped data</a></li><li><a href="#final-touch">Final touch</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/apify_logo.svg" alt="Apify SDK v2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/guides/motivation">Guide</a><a href="/docs/examples/crawl-multiple-urls">Examples</a><a href="/docs/api/apify">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/apify" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/apify" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/apifytech" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://apify.com" target="_blank">Apify Cloud</a><a href="https://docusaurus.io" target="_blank">Docusaurus</a><a href="https://github.com/apify/apify-sdk-v2" target="_blank">GitHub</a></div></section><section class="copyright">Copyright © 2022 Apify Technologies s.r.o.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                appId: 'N8EOCSBQGH',
                apiKey: 'b43e67a96ed18c7f63f5fd965906a96d',
                indexName: 'apify_sdk',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:1.0.1"]}
              });
            </script></body></html>