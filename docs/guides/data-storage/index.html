<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Data Storage · Apify SDK v2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The Apify SDK has several data storage types that are useful for specific tasks. The data is stored either on local disk to a directory defined by the"/><meta name="docsearch:version" content="2.3.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Data Storage · Apify SDK v2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sdk.apify.com/"/><meta property="og:description" content="The Apify SDK has several data storage types that are useful for specific tasks. The data is stored either on local disk to a directory defined by the"/><meta property="og:image" content="https://sdk.apify.com/img/apify_og_SDK.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://sdk.apify.com/img/apify_og_SDK.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai-sublime.min.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-67003981-4"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'UA-67003981-4');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/apify_logo.svg" alt="Apify SDK v2"/><h2 class="headerTitleWithLogo">Apify SDK v2</h2></a><a href="/versions"><h3>2.3.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="/docs/guides/motivation" target="_self">Guide</a></li><li class=""><a href="/docs/examples/crawl-multiple-urls" target="_self">Examples</a></li><li class=""><a href="/docs/api/apify" target="_self">API Reference</a></li><li class=""><a href="https://github.com/apify/apify-sdk-v2" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Data Storage</h1></header><article><div><span><p>The Apify SDK has several data storage types that are useful for specific tasks. The data is stored either on local disk to a directory defined by the
<code>APIFY_LOCAL_STORAGE_DIR</code> environment variable, or on the <a href="../guides/apify-platform">Apify platform</a> under the user account
identified by the API token defined by the <code>APIFY_TOKEN</code> environment variable. If neither of these variables is defined, by default Apify SDK sets
<code>APIFY_LOCAL_STORAGE_DIR</code> to <code>./apify_storage</code> in the current working directory and prints a warning.</p>
<p>Typically, you will be developing the code on your local computer and thus set the <code>APIFY_LOCAL_STORAGE_DIR</code> environment variable. Once the code is
ready, you will deploy it to the Apify platform, where it will automatically set the <code>APIFY_TOKEN</code> environment variable and thus use cloud storage. No
code changes are needed.</p>
<p><strong>Related links</strong></p>
<ul>
<li><a href="https://docs.apify.com/storage" target="_blank" rel="noopener">Apify platform storage documentation</a></li>
<li><a href="https://my.apify.com/storage" target="_blank" rel="noopener">View storage in Apify app</a></li>
<li><a href="https://apify.com/docs/api/v2#/reference/key-value-stores" target="_blank" rel="noopener">API reference</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="key-value-store"></a><a href="#key-value-store" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Key-value store</h2>
<p>The key-value store is used for saving and reading data records or files. Each data record is represented by a unique key and associated with a MIME
content type. Key-value stores are ideal for saving screenshots of web pages, PDFs or to persist the state of crawlers.</p>
<p>Each actor run is associated with a <strong>default key-value store</strong>, which is created exclusively for the actor run. By convention, the actor run input
and output is stored in the default key-value store under the <code>INPUT</code> and <code>OUTPUT</code> key, respectively. Typically the input and output is a JSON file,
although it can be any other format.</p>
<p>In the Apify SDK, the key-value store is represented by the <a href="../api/key-value-store"><code>KeyValueStore</code></a> class. In order to simplify access to the default
key-value store, the SDK also provides <a href="../api/apify#getvalue"><code>Apify.getValue()</code></a> and
<a href="../api/apify#setvalue"><code>Apify.setValue()</code></a> functions.</p>
<p>In local configuration, the data is stored in the directory specified by the <code>APIFY_LOCAL_STORAGE_DIR</code> environment variable as follows:</p>
<pre><code class="hljs"><span class="token punctuation">{</span><span class="token constant">APIFY_LOCAL_STORAGE_DIR</span><span class="token punctuation">}</span><span class="token operator">/</span>key_value_stores<span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">STORE_ID</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">KEY</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">{</span><span class="token constant">EXT</span><span class="token punctuation">}</span>
</code></pre>
<p>Note that <code>{STORE_ID}</code> is the name or ID of the key-value store. The default key value store has ID <code>default</code>, unless you override it by setting the
<code>APIFY_DEFAULT_KEY_VALUE_STORE_ID</code> environment variable. The <code>{KEY}</code> is the key of the record and <code>{EXT}</code> corresponds to the MIME content type of the
data value.</p>
<p>The following code demonstrates basic operations of key-value stores:</p>
<pre><code class="hljs css language-javascript"><span class="token comment">// Get actor input from the default key-value store</span>
<span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">getInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write actor output to the default key-value store.</span>
<span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'OUTPUT'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> myResult<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open a named key-value store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openKeyValueStore</span><span class="token punctuation">(</span><span class="token string">'some-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write record. JavaScript object is automatically converted to JSON,</span>
<span class="token comment">// strings and binary buffers are stored as they are</span>
<span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'some-key'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Read record. Note that JSON is automatically parsed to a JavaScript object,</span>
<span class="token comment">// text data returned as a string and other data is returned as binary buffer</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">'some-key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete record</span>
<span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'some-key'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>To see a real-world example of how to get the input from the key-value store, see the <a href="../examples/screenshots">Screenshots</a> example.</p>
<h2><a class="anchor" aria-hidden="true" id="dataset"></a><a href="#dataset" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dataset</h2>
<p>Datasets are used to store structured data where each object stored has the same attributes, such as online store products or real estate offers. You
can imagine a dataset as a table, where each object is a row and its attributes are columns. Dataset is an append-only storage - you can only add new
records to it but you cannot modify or remove existing records.</p>
<p>When the dataset is stored on the <a href="../guides/apify-platform">Apify platform</a>, you can export its data to the following formats: HTML,
JSON, CSV, Excel, XML and RSS. The datasets are displayed on the actor run details page and in the
<a href="https://my.apify.com/storage" target="_blank" rel="noopener">Storage</a> section in the Apify app. The actual data is exported using the
<a href="https://apify.com/docs/api/v2#/reference/datasets/item-collection/get-items" target="_blank" rel="noopener">Get dataset items</a> Apify API endpoint. This
way you can easily share crawling results.</p>
<p>Each actor run is associated with a <strong>default dataset</strong>, which is created exclusively for the actor run. Typically, it is used to store crawling
results specific for the actor run. Its usage is optional.</p>
<p>In the Apify SDK, the dataset is represented by the <a href="../api/dataset"><code>Dataset</code></a> class. In order to simplify writes to the default dataset, the SDK
also provides the <a href="../api/apify#pushdata"><code>Apify.pushData()</code></a> function.</p>
<p>In local configuration, the data is stored in the directory specified by the <code>APIFY_LOCAL_STORAGE_DIR</code> environment variable as follows:</p>
<pre><code class="hljs"><span class="token punctuation">{</span><span class="token constant">APIFY_LOCAL_STORAGE_DIR</span><span class="token punctuation">}</span><span class="token operator">/</span>datasets<span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">DATASET_ID</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">INDEX</span><span class="token punctuation">}</span><span class="token punctuation">.</span>json
</code></pre>
<p>Note that <code>{DATASET_ID}</code> is the name or ID of the dataset. The default dataset has ID <code>default</code>, unless you override it by setting the
<code>APIFY_DEFAULT_DATASET_ID</code> environment variable. Each dataset item is stored as a separate JSON file, where <code>{INDEX}</code> is a zero-based index of the
item in the dataset.</p>
<p>The following code demonstrates basic operations of the dataset:</p>
<pre><code class="hljs css language-javascript"><span class="token comment">// Write a single row to the default dataset</span>
<span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> col1<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span> col2<span class="token operator">:</span> <span class="token string">'val2'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open a named dataset</span>
<span class="token keyword">const</span> dataset <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openDataset</span><span class="token punctuation">(</span><span class="token string">'some-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write a single row</span>
<span class="token keyword">await</span> dataset<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Write multiple rows</span>
<span class="token keyword">await</span> dataset<span class="token punctuation">.</span><span class="token function">pushData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar2'</span><span class="token punctuation">,</span> col2<span class="token operator">:</span> <span class="token string">'val2'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> col3<span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>To see how to use the dataset to store crawler results, see the <a href="../examples/cheerio-crawler">Cheerio Crawler</a> example.</p>
<h2><a class="anchor" aria-hidden="true" id="request-queue"></a><a href="#request-queue" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Request queue</h2>
<p>The request queue is a storage of URLs to crawl. The queue is used for the deep crawling of websites, where you start with several URLs and then
recursively follow links to other pages. The data structure supports both breadth-first and depth-first crawling orders.</p>
<p>Each actor run is associated with a <strong>default request queue</strong>, which is created exclusively for the actor run. Typically, it is used to store URLs to
crawl in the specific actor run. Its usage is optional.</p>
<p>In Apify SDK, the request queue is represented by the <a href="../api/request-queue"><code>RequestQueue</code></a> class.</p>
<p>In local configuration, the request queue data is stored in the directory specified by the <code>APIFY_LOCAL_STORAGE_DIR</code> environment variable as follows:</p>
<pre><code class="hljs"><span class="token punctuation">{</span><span class="token constant">APIFY_LOCAL_STORAGE_DIR</span><span class="token punctuation">}</span><span class="token operator">/</span>request_queues<span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">QUEUE_ID</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">STATE</span><span class="token punctuation">}</span><span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">NUMBER</span><span class="token punctuation">}</span><span class="token punctuation">.</span>json
</code></pre>
<p>Note that <code>{QUEUE_ID}</code> is the name or ID of the request queue. The default queue has ID <code>default</code>, unless you override it by setting the
<code>APIFY_DEFAULT_REQUEST_QUEUE_ID</code> environment variable. Each request in the queue is stored as a separate JSON file, where <code>{STATE}</code> is either
<code>handled</code> or <code>pending</code>, and <code>{NUMBER}</code> is an integer indicating the position of the request in the queue.</p>
<p>The following code demonstrates basic operations of the request queue:</p>
<pre><code class="hljs css language-javascript"><span class="token comment">// Open the default request queue associated with the actor run</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Open a named request queue</span>
<span class="token keyword">const</span> queueWithName <span class="token operator">=</span> <span class="token keyword">await</span> Apify<span class="token punctuation">.</span><span class="token function">openRequestQueue</span><span class="token punctuation">(</span><span class="token string">'some-name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Enqueue few requests</span>
<span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'http://example.com/aaa'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'http://example.com/bbb'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">addRequest</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> <span class="token string">'http://example.com/foo/bar'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> forefront<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Get requests from queue</span>
<span class="token keyword">const</span> request1 <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">fetchNextRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request2 <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">fetchNextRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> request3 <span class="token operator">=</span> <span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">fetchNextRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mark a request as handled</span>
<span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">markRequestHandled</span><span class="token punctuation">(</span>request1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// If processing fails then reclaim the request back to the queue, so that it's crawled again</span>
<span class="token keyword">await</span> queue<span class="token punctuation">.</span><span class="token function">reclaimRequest</span><span class="token punctuation">(</span>request2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>To see how to use the request queue with a crawler, see the <a href="../examples/puppeteer-crawler">Puppeteer Crawler</a> example.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#key-value-store">Key-value store</a></li><li><a href="#dataset">Dataset</a></li><li><a href="#request-queue">Request queue</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/apify_logo.svg" alt="Apify SDK v2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/guides/motivation">Guide</a><a href="/docs/examples/crawl-multiple-urls">Examples</a><a href="/docs/api/apify">API Reference</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/apify" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://twitter.com/apify" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://www.facebook.com/apifytech" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="https://apify.com" target="_blank">Apify Cloud</a><a href="https://docusaurus.io" target="_blank">Docusaurus</a><a href="https://github.com/apify/apify-sdk-v2" target="_blank">GitHub</a></div></section><section class="copyright">Copyright © 2022 Apify Technologies s.r.o.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                appId: 'N8EOCSBQGH',
                apiKey: 'b43e67a96ed18c7f63f5fd965906a96d',
                indexName: 'apify_sdk',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:2.3.0"]}
              });
            </script></body></html>